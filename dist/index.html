
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blender Render Pipeline</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        function App() {
            const [settings, setSettings] = useState({
                blenderPath: '',
                blendFile: '',
                outputDir: '',
                frameStart: 1,
                frameEnd: 250,
                resolutionX: 1920,
                resolutionY: 1080,
                samples: 128,
                denoiseMethod: 'OIDN',
                useCuda: true,
                enableUpscale: false,
                enableInterpolation: false,
                codec: 'prores_ks',
                framerate: 30
            });
            
            const [status, setStatus] = useState({
                step: 'idle',
                progress: 0,
                message: '準備完了'
            });
            
            const [isRendering, setIsRendering] = useState(false);
            
            // ステータスを定期的に更新
            useEffect(() => {
                const interval = setInterval(async () => {
                    try {
                        const response = await fetch('/api/status');
                        const data = await response.json();
                        setStatus(data);
                        setIsRendering(data.step !== 'idle' && data.step !== 'complete' && data.step !== 'error');
                    } catch (error) {
                        console.error('Status update failed:', error);
                    }
                }, 1000);
                
                return () => clearInterval(interval);
            }, []);
            
            const handleStartRender = async () => {
                try {
                    const response = await fetch('/api/start-render', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ settings })
                    });
                    
                    if (!response.ok) {
                        const error = await response.json();
                        alert('エラー: ' + error.error);
                    }
                } catch (error) {
                    alert('レンダリング開始に失敗しました: ' + error.message);
                }
            };
            
            const getStepName = (step) => {
                const steps = {
                    'idle': '待機中',
                    'rendering': 'レンダリング',
                    'denoising': 'ノイズ除去',
                    'upscaling': 'アップスケール',
                    'interpolating': 'フレーム補間',
                    'encoding': '動画化',
                    'complete': '完了',
                    'error': 'エラー'
                };
                return steps[step] || step;
            };
            
            return (
                <div className="container mx-auto p-6 max-w-6xl">
                    <div className="text-center mb-8">
                        <h1 className="text-4xl font-bold text-white mb-2">
                            Blender Render Pipeline
                        </h1>
                        <p className="text-white opacity-80">
                            プロフェッショナル3Dレンダリング with AI強化
                        </p>
                    </div>
                    
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        {/* 設定パネル */}
                        <div className="lg:col-span-2">
                            <div className="card p-6 mb-6">
                                <h2 className="text-xl font-bold mb-4">基本設定</h2>
                                
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Blender実行ファイル</label>
                                        <input
                                            type="text"
                                            className="w-full p-2 border rounded-lg"
                                            placeholder="C:/Program Files/Blender Foundation/Blender 4.0/blender.exe"
                                            value={settings.blenderPath}
                                            onChange={(e) => setSettings({...settings, blenderPath: e.target.value})}
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Blendファイル</label>
                                        <input
                                            type="text"
                                            className="w-full p-2 border rounded-lg"
                                            placeholder="レンダリングするBlendファイルのパス"
                                            value={settings.blendFile}
                                            onChange={(e) => setSettings({...settings, blendFile: e.target.value})}
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-1">出力ディレクトリ</label>
                                        <input
                                            type="text"
                                            className="w-full p-2 border rounded-lg"
                                            placeholder="レンダリング結果の保存先"
                                            value={settings.outputDir}
                                            onChange={(e) => setSettings({...settings, outputDir: e.target.value})}
                                        />
                                    </div>
                                    
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">開始フレーム</label>
                                            <input
                                                type="number"
                                                className="w-full p-2 border rounded-lg"
                                                value={settings.frameStart}
                                                onChange={(e) => setSettings({...settings, frameStart: parseInt(e.target.value)})}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">終了フレーム</label>
                                            <input
                                                type="number"
                                                className="w-full p-2 border rounded-lg"
                                                value={settings.frameEnd}
                                                onChange={(e) => setSettings({...settings, frameEnd: parseInt(e.target.value)})}
                                            />
                                        </div>
                                    </div>
                                    
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">幅</label>
                                            <input
                                                type="number"
                                                className="w-full p-2 border rounded-lg"
                                                value={settings.resolutionX}
                                                onChange={(e) => setSettings({...settings, resolutionX: parseInt(e.target.value)})}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">高さ</label>
                                            <input
                                                type="number"
                                                className="w-full p-2 border rounded-lg"
                                                value={settings.resolutionY}
                                                onChange={(e) => setSettings({...settings, resolutionY: parseInt(e.target.value)})}
                                            />
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-1">サンプル数</label>
                                        <input
                                            type="number"
                                            className="w-full p-2 border rounded-lg"
                                            value={settings.samples}
                                            onChange={(e) => setSettings({...settings, samples: parseInt(e.target.value)})}
                                        />
                                    </div>
                                </div>
                            </div>
                            
                            <div className="card p-6">
                                <h2 className="text-xl font-bold mb-4">AI強化設定</h2>
                                
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">ノイズ除去方式</label>
                                        <select
                                            className="w-full p-2 border rounded-lg"
                                            value={settings.denoiseMethod}
                                            onChange={(e) => setSettings({...settings, denoiseMethod: e.target.value})}
                                        >
                                            <option value="OIDN">Intel Open Image Denoise</option>
                                            <option value="FastDVDnet">FastDVDnet</option>
                                        </select>
                                    </div>
                                    
                                    <div className="flex items-center space-x-2">
                                        <input
                                            type="checkbox"
                                            id="cuda"
                                            checked={settings.useCuda}
                                            onChange={(e) => setSettings({...settings, useCuda: e.target.checked})}
                                        />
                                        <label htmlFor="cuda" className="text-sm font-medium">CUDA加速を使用</label>
                                    </div>
                                    
                                    <div className="flex items-center space-x-2">
                                        <input
                                            type="checkbox"
                                            id="upscale"
                                            checked={settings.enableUpscale}
                                            onChange={(e) => setSettings({...settings, enableUpscale: e.target.checked})}
                                        />
                                        <label htmlFor="upscale" className="text-sm font-medium">AIアップスケール</label>
                                    </div>
                                    
                                    <div className="flex items-center space-x-2">
                                        <input
                                            type="checkbox"
                                            id="interpolation"
                                            checked={settings.enableInterpolation}
                                            onChange={(e) => setSettings({...settings, enableInterpolation: e.target.checked})}
                                        />
                                        <label htmlFor="interpolation" className="text-sm font-medium">フレーム補間</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {/* ステータスパネル */}
                        <div className="space-y-6">
                            <div className="card p-6">
                                <h2 className="text-xl font-bold mb-4">レンダリング状態</h2>
                                
                                <div className="space-y-4">
                                    <div>
                                        <div className="flex justify-between text-sm mb-1">
                                            <span>現在のステップ:</span>
                                            <span className="font-medium">{getStepName(status.step)}</span>
                                        </div>
                                        
                                        <div className="flex justify-between text-sm mb-2">
                                            <span>進捗:</span>
                                            <span>{Math.round(status.progress)}%</span>
                                        </div>
                                        
                                        <div className="w-full bg-gray-200 rounded-full h-2">
                                            <div 
                                                className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                                                style={{width: `${status.progress}%`}}
                                            ></div>
                                        </div>
                                    </div>
                                    
                                    <div className="text-sm text-gray-600">
                                        {status.message}
                                    </div>
                                    
                                    <button
                                        onClick={handleStartRender}
                                        disabled={isRendering}
                                        className={`w-full py-3 px-4 rounded-lg font-medium ${
                                            isRendering 
                                                ? 'bg-gray-400 cursor-not-allowed' 
                                                : 'bg-blue-600 hover:bg-blue-700 text-white'
                                        }`}
                                    >
                                        {isRendering ? 'レンダリング中...' : 'レンダリング開始'}
                                    </button>
                                </div>
                            </div>
                            
                            <div className="card p-6">
                                <h2 className="text-xl font-bold mb-4">プレビュー</h2>
                                <div className="aspect-video bg-gray-100 rounded-lg flex items-center justify-center">
                                    {status.preview_image ? (
                                        <img 
                                            src={status.preview_image || "/placeholder.svg"} 
                                            alt="Preview" 
                                            className="max-w-full max-h-full rounded-lg"
                                        />
                                    ) : (
                                        <div className="text-gray-500 text-center">
                                            <div className="text-4xl mb-2">🎬</div>
                                            <p>プレビューはここに表示されます</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
    